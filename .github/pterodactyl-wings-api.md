# Pterodactyl Wings API expectations

This document captures what the Panel expects from a Wings node. Use it as a living reference while building the mock Wings agent.

## Core expectations
- TLS: Panel talks to Wings over HTTPS. The node must present a valid certificate (PEM/PFX or self-signed fallback).
- Authentication: requests are authenticated with a node-level token (``token`` / ``token_id``). Panel sends `Authorization: Bearer <token>`.
- CORS: the Panel UI issues OPTIONS preflight; the node must respond with proper CORS headers for `/api/*` endpoints.
- SFTP: file uploads (server archives, config) use SFTP; bind port is configurable via `system.sftp.bind_port`.
- Console: Panels may open websocket console connections to Wings; a token-based handshake is used.

## Prioritized endpoints to implement in the mock agent
1. `GET /api/system`
   - Returns node identity and configuration fields: `uuid`, `token_id`, `token`, `api` (host/port/ssl), `system` (sftp bind port, data path), `remote` (panel URL), `debug`.
   - Supports `?v=2` which returns the detailed information structure used by Wings (includes `version`, `docker` {version, cgroups, containers, storage, runc}, and `system` {architecture, cpu_threads, memory_bytes, kernel_version, os, os_type}).
   - Must respond to `OPTIONS /api/system` (return 204 + CORS headers).
2. `GET /api/servers/:uuid`
   - Returns server status & metadata (pid, last_start, instance token, etc.).

Additional endpoint:
- `POST /api/update` â€” Panel uses this to update Wings configuration. The daemon should accept a JSON/YAML configuration payload, persist it to the configured `WINGS_CONFIG_PATH` if present, and return `{ applied: true }` on success.
3. `POST /api/servers/:uuid/power` -> `{ action: 'start'|'stop'|'restart' }`
   - Should invoke start/stop logic for the instance and return `202 Accepted` when action queued.
4. `POST /api/servers/:uuid/command` -> `{ command: '...' }`
   - Accepts console commands and appends to console log (or forwards to server).
5. Websocket console endpoints (advanced)
   - Implement a minimal websocket stub that accepts a console token and proxies to server console logs (optional for initial compatibility).

## Implementation notes
- Implement `pid_start_time` and `instance_token` validation to avoid killing/reused PIDs.
- Do not persist or log sensitive tokens; only expose them as required by the Panel.
- Support `WINGS_CONFIG_PATH` env var to specify a config file (YAML/JSON) path to mirror a real Wings node.

## Next task
- Fetch exact implementation details from the `pterodactyl/wings` and `pterodactyl/panel` repositories to confirm the exact response schemas and websocket handshake for console sessions.

(Generated by GitHub Copilot assistant.)